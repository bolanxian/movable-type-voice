import{b as Y,B as Q,y as L,w as ee,t as te,p as ne,d as se,c as u,a as re}from"./vendor-CpA3Anaw.js";class ae{#e;constructor(e){this.#e=e}get readable(){return this.#e}async start(e){const t=this.#e=await this.#e;t.on("data",n=>{e.enqueue(new Uint8Array(n.buffer,n.byteOffset,n.byteLength)),t.pause()}),t.on("end",()=>e.close()),t.on("error",n=>e.error(n)),t.pause()}pull(e){this.#e.resume()}cancel(e){this.#e.destroy(e)}}const oe=s=>new ReadableStream(new ae(s)),z=s=>{let e;return new Y.Readable({async construct(t){let n=null;try{e=(await s).getReader()}catch(r){n=r}t(n)},async read(t){try{const{done:n,value:r}=await e.read();if(n){this.push(null);return}this.push(Q.from(r.buffer,r.byteOffset,r.byteLength))}catch(n){this.destroy(n)}},async destroy(t,n){try{e!=null&&await e.cancel(t)}catch(r){t=r}n(t)}})};class E{constructor(e,t){this.yauzlEntry=e,this.yauzlZipFile=t,this.name=e.fileName,this.size=e.uncompressedSize}stream(){const{yauzlZipFile:e,yauzlEntry:t}=this;return oe(new Promise((n,r)=>{e.openReadStream(t,(i,a)=>{i==null?n(a):r(i)})}))}blob(){return new Response(this.stream()).blob()}arrayBuffer(){return new Response(this.stream()).arrayBuffer()}text(){return new Response(this.stream()).text()}static async*readEntries(e){let t,n,r=!1;const i=c=>{t(c)},a=()=>{r=!0,t()},o=c=>{n(c)},l=(c,h)=>{t=c,n=h,e.readEntry()};try{for(e.on("entry",i),e.on("end",a),e.on("error",o);;){const c=await new Promise(l);if(r)return;yield new E(c,e)}}catch(c){throw c}finally{e.removeListener("entry",i),e.removeListener("end",a),e.removeListener("error",o)}}static async fromRandomAccessReader(e,t){const n=await new Promise((r,i)=>{const a=new L.RandomAccessReader;a._readStreamForRange=e,L.fromRandomAccessReader(a,t,{autoClose:!1,lazyEntries:!0},(o,l)=>{o==null?r(l):i(o)})});return[n.entryCount,this.readEntries(n)]}static fromBlob(e){return this.fromRandomAccessReader((t,n)=>z(e.slice(t,n).stream()),e.size)}static async fromUrl(e){const t=await fetch(e,{method:"HEAD"}),n=await t.blob();if(n.size>0)return this.fromBlob(n);if(t.headers.get("accept-ranges")!=="bytes")return null;const r=async(i,a)=>{const o=await fetch(e,{headers:{range:`bytes=${i??0}-${a!=null?a-1:""}`}});if(o.status!==206)throw new TypeError("Range not satisfiable");return o.body};return this.fromRandomAccessReader((i,a)=>z(r(i,a)),+t.headers.get("content-length"))}}const ie="ei",ce="bi",le="xi",ue="di",de="yi",he="ai fu",pe="ji",me="ai chi",fe="ai",ye="zhei",be="kei",ge="ai lu",we="ai mu",ve="en",xe="ou",$e="pi",Ee="kiu",Pe="a",Re="ai si",Te="ti",Be="you",Se="wei",Ae="da bu liu",Me="ai ke si",Fe="wai",De="zei",j={0:"ling",1:"yi",2:"er",3:"san",4:"si",5:"wu",6:"liu",7:"qi",8:"ba",9:"jiu",a:ie,b:ce,c:le,d:ue,e:de,f:he,g:pe,h:me,i:fe,j:ye,k:be,l:ge,m:we,n:ve,o:xe,p:$e,q:Ee,r:Pe,s:Re,t:Te,u:Be,v:Se,w:Ae,x:Me,y:Fe,z:De,"\\.":"dian"};class k{constructor(e=48e3){this.entryMap=new Map,this.audioMap=new Map;const t=this.audioContext=new OfflineAudioContext({sampleRate:e,length:1});this.decodeAudioData=r=>t.decodeAudioData(r);const n=this.pau=new AudioBuffer({sampleRate:e,length:Math.trunc(.2*e)});this.audioMap.set("pau",Promise.resolve(n))}injectUnzipEntries(e){for(const t of e){if(t==null)continue;let n=String(t.name),r;n=n.slice(n.lastIndexOf("/")+1),(r=n.indexOf("."))>0&&(n=n.slice(0,r)),this.entryMap.set(n,t)}}has(e){return this.audioMap.has(e)||this.entryMap.has(e)}get(e){let t=this.audioMap.get(e);if(t!=null)return t;const n=this.entryMap.get(e);return n==null?null:(t=Promise.resolve(n.arrayBuffer()).then(this.decodeAudioData),this.audioMap.set(e,t),t)}async encodeAudioData(e){const{sampleRate:t}=this.audioContext,n=new Float32Array(await new Blob(e).arrayBuffer()),r=await ee.encode({sampleRate:t,channelData:[n]});return new Blob([r])}async concat(e){const t=[this.pau];for(const n of e){const r=await this.get(n);r!=null&&t.push(r.getChannelData(0))}return t.push(this.pau),this.encodeAudioData(t)}}const{apply:Le}=Reflect,{bind:S,call:ze}=Function.prototype,M=Le(S,S,[ze]),v=new WeakMap,{get:I,set:q}=WeakMap.prototype,O=M(I),x=M(q);x(v,I,O);x(v,q,x);const _=s=>{let e=O(v,s);return e==null&&(e=M(s),x(v,s,e)),e},je=_(S),Ue={get(s,e,t){const n=s[e];if(typeof n=="function")return _(n)}},F=s=>new Proxy(s,Ue),Ce=F(Number.prototype),Ne=F(String.prototype);F(Array.prototype);const A=je(Performance.prototype.now,performance),{toFixed:ke}=Ce,{padStart:w,repeat:U,slice:V}=Ne,Ie=BigInt,{pow:qe,min:Oe,trunc:W}=Math,Z=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],P=Array.from(Z,(s,e)=>qe(1024,e)),R=s=>{let e=1,t=P.length;for(;e<t&&s>P[e];)e++;return e--,`${ke(s/P[e],Oe(2,e>>1))}${Z[e]}`};function*_e(s){if(s=W(s),!(s>=0))return yield"Êú™Áü•";if(!(s<864e4))return yield"‚àû";switch(s=Ie(s),!0){case s>=86400n:yield`${w(s/86400n,2,"0")} Â§©`,s%=86400n;case s>=3600n:yield`${w(s/3600n,2,"0")} Êó∂`,s%=3600n;case s>=60n:yield`${w(s/60n,2,"0")} ÂàÜ`,s%=60n;default:yield`${w(s,2,"0")} Áßí`}}const C=s=>{const[e,t]=_e(s);return`${e}${t!=null?` ${t}`:""}`},Ve=`${U("üü©",49)}üü®${U("üü¶",49)}`,We=(s,e)=>{const t=50-W(50*s/e);return t>=0?V(Ve,2*t,2*(t+49)):""},T=(s,e)=>{const t=C((A()-e)/1e3),{loaded:n,speed:r}=s,i=R(n),a=R(r);if(!s.lengthComputable)return`[ ${a}/s ][ ${t} ] ${i}`;const{total:o,percent:l}=s,c=o-n,h=R(o),p=C(c>0?c/r:0);return`${We(n,o)}
[ ${l} ][ ${a}/s ][ ${t} ][ Ââ©‰Ωô ${p} ] ${i}/${h}
`},{MAX_SAFE_INTEGER:Ze}=Number,{min:Ge}=Math;let $,D;class G{static{$=(e,t)=>{e.#e+=t,e.#s(t)},D=e=>{e.#r=!0}}#e=0;#t=0;#n=!1;#s=te();#r=!1;constructor(e){e=+e,e>0&&e<=Ze&&(this.#t=e,this.#n=!0)}get loaded(){return this.#e}get total(){return this.#t}get lengthComputable(){return this.#n}get speed(){return this.#s(0)}get percent(){if(this.#r)return"100%";if(!this.#n)return"NaN%";let e=Ge(99.9,100*this.#e/this.#t);return e>=0?`${V(e,0,4)}%`:"NaN%"}}class He{#e;constructor(e){this.#e=e}transform(e,t){$(this.#e,e.byteLength),t.enqueue(e)}flush(e){D(this.#e)}}class Xe extends TransformStream{static fromResponse(e){const{body:t,headers:n}=e,r=new this(n.get("content-length")),i=t.locked?r.readable:t.pipeThrough(r);return[r,new Response(i,e)]}#e;constructor(e){const t=new G(e);super(new He(t)),this.#e=t}get progress(){return this.#e}}const H=[[new RegExp(Object.keys(j).join("|")),s=>j[s]],[/[\s,„ÄÅÔºå„ÄÇÔºöÔºõ‚Äî‚Äî]+/,()=>"pau"],[/[\u4E00-\u9FEF]/,s=>ne.getPinyin(s," ",!1,!1)]],{get:Je}=Reflect,Ke=RegExp.prototype,{matchAll:Ye}=String.prototype;class m{static createParser(e){const t=new Map(e),n=new RegExp(Array.from(t.keys(),a=>`(${Je(Ke,"source",a)})`).join("|"),"g"),r=Array.from(t.values());return function*(a){for(const o of Ye.call(a,n)){let l,c;for(l=1;l<o.length;l++)if((c=o[l])!=null){yield r[l-1](c);break}}}}static cachePromise=caches.open("movable-type-voice");constructor(e,t){this.blobPromise=null,this.entriesPromise=null,this.libraryPromise=null,this.parse=null,e instanceof Blob?(this.url=null,this.name=t??(e instanceof File?e.name:""),this.blobPromise=Promise.resolve(e)):(this.url=`${e}.zip`,this.name=t??e)}async createBlob(e={}){const{url:t,name:n}=this,r=await m.cachePromise;e.onFetchStart?.(n);let i=await r.match(t),a,o;if(i!=null){const{headers:c}=i,h=c.get("date");if(!(Date.now()-Date.parse(h)<1e3*60*60*24*7)){const p={},b=c.get("etag"),f=c.get("last-modified");b!=null&&(p["if-none-match"]=b),f!=null&&(p["if-modified-since"]=f);const y=await fetch(t,{headers:p});if(y.status===304){for(const[g,d]of y.headers)c.set(g,d);a=r.put(t,i.clone())}else if(y.status===200)i=y,a=r.put(t,i.clone()),o=e.onFetch;else throw new TypeError(`Request failed with status code ${y.status}`)}}else{if(i=await fetch(t),i.status!==200)throw new TypeError(`Request failed with status code ${i.status}`);a=r.put(t,i.clone()),o=e.onFetch}if(o!=null){let c;[c,i]=Xe.fromResponse(i),o(n,c.progress)}const l=await i.blob();return a!=null&&await a,e.onFetchEnd?.(n),l}getBlob(e){return this.blobPromise==null&&(this.blobPromise=this.createBlob(e)),this.blobPromise}async createEntries(e){const{name:t}=this,n=await this.getBlob(e);e.onUnzipStart?.(t);const[r,i]=await E.fromBlob(n),a=[];for await(const o of i)a.push(o);return e.onUnzipEnd?.(t),a}getEntries(e){return this.entriesPromise==null&&(this.entriesPromise=this.createEntries(e)),this.entriesPromise}async createVoiceLibrary(e,t={}){const n=new k(e);return n.injectUnzipEntries(await this.getEntries(t)),this.parse=m.createParser(H),n}async getVoiceLibrary(e,t){if(this.libraryPromise!=null)try{const n=await this.libraryPromise;if(n!=null&&n.audioContext.sampleRate===e)return n}catch{}return this.libraryPromise=this.createVoiceLibrary(e,t),this.libraryPromise}}class X extends m{constructor(e,t){Array.isArray(e)?(super(e[1],`${t}(ÂéüÂ£∞Â§ßÁ¢ü)`),this.main=new m(e[0],t)):(super(`${e}.ex`,`${t}(ÂéüÂ£∞Â§ßÁ¢ü)`),this.main=new m(e,t))}async createVoiceLibrary(e,t={}){const n=new k(e);for(const a of[this.main,this])n.injectUnzipEntries(await a.getEntries(t));const r=n.entryMap.get("table"),i=r!=null?JSON.parse(await r.text()):{};return n.entryMap.delete("table"),this.parse=m.createParser([[new RegExp(Object.keys(i).sort((a,o)=>o.length-a.length).join("|")),a=>i[a]],...H]),n}}const B="Ê¥ªÂ≠óÂç∞Âà∑ËØ≠Èü≥",Qe=se({name:B,props:{map:{type:Map,require:!0}},data(){return{audioSrc:null}},mounted(){const s=this.$el,e=s.ownerDocument;e.title=B,s.querySelector("[name=voice]").click(),e.addEventListener("dragover",this.handleDragover),e.addEventListener("drop",this.handleDrop)},beforeUnmount(){const s=this.$el,e=s.ownerDocument;e.removeEventListener("dragover",this.handleDragover),e.removeEventListener("drop",this.handleDrop)},methods:{handleDragover(s){s.preventDefault(),s.stopPropagation()},handleDrop(s){{const{target:o}=s,l=o.tagName;if(l==="INPUT"||l==="TEXTAREA"||o.isContentEditable)return}s.preventDefault(),s.stopPropagation();const e=s.dataTransfer??s.clipboardData;if(e==null)return;const t=".zip",n=".ex.zip";let r,i;for(const o of e.files)o.name.endsWith(n)?i=o:o.name.endsWith(t)&&(r=o);const a=this.map;if(r!=null){let o=r.name.slice(0,-t.length);if(i!=null){if(i.name.slice(0,-n.length)!=o)return;const l=new X([r,i],o);a.set(l.main.name,l.main),a.set(o=l.name,l)}else a.set(o,new m(r,o));this.$forceUpdate(),setTimeout(()=>{this.$refs.form.elements.namedItem("voice").value=o},0)}},async testZip(s){const{name:e}=s,t=[],n=await E.fromBlob(s);for await(const r of n)t.push(r),console.log(e,r.name,r),await r.stream().pipeTo(new WritableStream);console.log(s,t)},testProgress(s=1,e=128){const t=this.$el.querySelector("[name=tip]"),n=new G(e*1024*1024),r=A(),a=setInterval(()=>{$(n,s*1024*1024/10),n.loaded>=n.total&&($(n,n.total-n.loaded),D(n),clearInterval(a)),t.innerText=T(n,r)},100);t.innerText=T(n,r)},async handleSubmit(s){s.preventDefault(),s.stopPropagation();const e=this,{target:t,submitter:n}=s,{elements:r}=t,i=r.namedItem("dest"),a=t.querySelector("[name=tip]");URL.revokeObjectURL(e.audioSrc),e.audioSrc=null,n.disabled=!0,a.innerText="",i.value="";let o=null,l,c,h,p;const b=()=>{a.innerText=`Ê≠£Âú®‰∏ãËΩΩÔºö${c}
${T(h,p)}`};try{a.innerText=(l="Âä†ËΩΩ")+"‰∏≠";const f=e.map.get(r.namedItem("voice").value),y=await f.getVoiceLibrary(48e3,{onFetchStart(d){a.innerText=`ÂºÄÂßã‰∏ãËΩΩÔºö${d}`},onFetch(d,K){c=d,h=K,p=A(),o==null&&(o=setInterval(b,100),b())},onFetchEnd(d){clearInterval(o),o=null,a.innerText=`‰∏ãËΩΩÂÆåÊàêÔºö${d}`},onUnzipStart(d){a.innerText=`ÂºÄÂßãÂä†ËΩΩÔºö${d}`},onUnzipEnd(d){a.innerText=`Âä†ËΩΩÂÆåÊàêÔºö${d}`}});a.innerText=(l=n.value)+"‰∏≠";const g=Array.from(f.parse(r.namedItem("src").value)).join(" ");e.audioSrc=URL.createObjectURL(await y.concat(g.split(" "))),a.innerText="",i.value=g}catch(f){throw clearInterval(o),o=null,a.innerText=l+"Â§±Ë¥•",f}finally{o!=null&&clearInterval(o),n.disabled=!1}}},render(){const s=this;return u("form",{ref:"form",class:"main",action:"javascript:void+0",onSubmit:s.handleSubmit},[u("div",{class:"title"},[u("h1",null,B)]),u("textarea",{name:"src"}),u("div",{style:"margin:10px 0px;"},[u("input",{type:"submit",value:"ÁîüÊàê",name:"gen"}),u("span",{style:"display:inline-block;"},Array.from(s.map.keys(),e=>u("label",null,[u("input",{type:"radio",name:"voice",value:e}),e])))]),u("textarea",{name:"dest",readonly:""}),u("div",{style:"margin:10px 0px;"},[s.audioSrc!=null?u("audio",{src:s.audioSrc,controls:"",style:"display: inline-block;"}):null,u("span",{name:"tip"})])])}}),N=new X("./otto","ÁîµÊ£ç"),J=new Map;for(const s of[N.main,N])J.set(s.name,s);const et=re(Qe,{map:J}).mount("#app");window.vm=et;
